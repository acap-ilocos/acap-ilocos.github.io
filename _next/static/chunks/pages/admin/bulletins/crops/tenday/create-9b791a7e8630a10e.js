(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{67947:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/create",function(){return t(30079)}])},53577:function(e,n,t){"use strict";var r=t(85893),i=t(87357),o=t(98456);n.Z=function(e){var n=e.text,t=void 0===n?"":n,l=e.size,a=void 0===l?24:l,s=e.children;return(0,r.jsxs)(i.Z,{sx:{width:"100%",textAlign:"center",height:"20vh"},children:[(0,r.jsxs)(i.Z,{sx:{width:"100%",textAlign:"center",marginTop:function(e){return e.spacing(12)},marginBottom:"32px",display:"flex",justifyContent:"center"},children:[(0,r.jsx)("span",{children:""!==t?t:"Loading..."})," \xa0",(0,r.jsx)(o.Z,{size:a})]}),s]})}},55688:function(e,n,t){"use strict";var r=t(85893),i=t(67294),o=t(45697),l=t.n(o),a=t(14866),s=t(46901);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var u=i.forwardRef((function(e,n){return(0,r.jsx)(s.Z,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){c(e,n,t[n])}))}return e}({elevation:6,ref:n,variant:"filled"},e))}));function d(e){var n=e.openSnackbar,t=e.message,o=e.severity,l=e.closeHandlerCB,s=void 0===l?function(){}:l,c=(0,i.useState)(n),d=c[0],f=c[1];(0,i.useEffect)((function(){f(n)}),[n]);var p=function(){f(!1),s()};return(0,r.jsx)(a.Z,{open:d,autoHideDuration:3e3,onClose:p,children:(0,r.jsx)(u,{onClose:p,severity:o,sx:{width:"100%"},children:t})})}d.propTypes={openSnackbar:l().bool,message:l().string,severity:l().string},n.Z=d},22094:function(e,n,t){"use strict";var r=t(85893),i=t(87357),o=t(11057),l=t(50657),a=t(31425),s=t(6514),c=t(37645),u=t(25675),d=t(26660),f=t(37634),p=t(53577);n.Z=function(e){var n=e.open,t=e.pdfPreview,v=e.error,g=void 0===v?"":v,h=e.loading,m=void 0!==h&&h,b=e.toggleViewerOpen;return(0,r.jsxs)(l.Z,{open:n,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,r.jsx)(c.Z,{id:"data-saved-success",children:t.filename?"Bulletin Preview - ".concat(t.filename):"Bulletin Preview"}),(0,r.jsx)(s.Z,{sx:{padding:0,overflow:"hidden"},children:(0,r.jsx)(i.Z,{id:"alert-dialog-description",children:m?(0,r.jsx)("div",{style:{width:"100%",height:"90vh",textAlign:"center"},children:(0,r.jsx)(p.Z,{text:"Loading Preview...",children:(0,r.jsx)(u.default,{unoptimized:!0,src:(0,d.assetPrefixer)("images/icons/data-processing-128.png"),height:100,width:100,loader:d.imageLoader,alt:"Loading Preview"})})}):""!==g?(0,r.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,r.jsx)(f.Z,{message:g})}):(0,r.jsx)("embed",{src:t.url,style:{width:"100%",height:"70vh"}})})}),(0,r.jsx)(a.Z,{children:(0,r.jsx)(o.Z,{variant:"contained",onClick:b,autoFocus:!0,children:"OK"})})]})}},30079:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ee}});var r=t(34051),i=t.n(r),o=t(85893),l=t(67294),a=t(9473),s=t(11163),c=t(45697),u=t.n(c),d=t(41664),f=t(21023),p=t(76295),v=t(11057),g=t(56863),h=t(87357),m=t(86886),b=t(93946),y=t(61903),_=t(15861),x=t(11829),j=t(19227),w=t(22094),O=t(55688),Z=t(12671),S=t(22757);function P(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){P(e,n,t[n])}))}return e}function C(e){var n=(0,l.useState)(!1),t=n[0],r=n[1],i=(0,s.useRouter)(),c=(0,a.I0)(),u=e.open,P=e.loading,C=e.isloadingreport,k=e.optsprovinces,T=e.optscrops,D=e.sel_options,A=e.message,I=e.pageTitle,L=void 0===I?"":I,B=e.pageDescription,N=void 0===B?"":B,F=e.pdfPreview,z=e.handleSave,R=e.resetSelections,W=e.togglePrompt,H=e.toggleViewerOpen,M=e.onSelectItemChange;(0,l.useEffect)((function(){null===D.sel_municipality&&!0===t&&r(!1)}),[D.sel_municipality,t]);var V=function(){c((0,Z.s_)()),i.push("/admin/bulletins/crops/")},G=function(){var e="Loading...";return k.length>0&&(e=null===D.sel_province?"Select a province":"Province"),e};return(0,o.jsxs)("div",{children:[(0,o.jsx)(j.Z,{isOpen:A.isOpen,maxWidth:"xs",openButtonText:null,title:A.title,contentText:A.msg,loading:A.loading,modalCancelHandlerCB:function(){A.savesuccess?V():W()},modalConfirmHandlerCB:function(){A.savesuccess?V():z()}}),(0,o.jsx)(w.Z,{open:u,pdfPreview:F,error:D.error,loading:D.loading,toggleViewerOpen:H}),(0,o.jsx)(O.Z,{openSnackbar:""!==D.error,message:D.error,severity:"warning"}),(0,o.jsxs)(m.ZP,{container:!0,sx:S.Z.container,children:[(0,o.jsxs)(h.Z,{sx:S.Z.headerText,children:[(0,o.jsxs)(h.Z,{children:[(0,o.jsx)(_.Z,{variant:"h5",children:L}),(0,o.jsx)("p",{dangerouslySetInnerHTML:{__html:N}})]}),(0,o.jsx)(h.Z,{children:(0,o.jsx)(b.Z,{"aria-label":"exit",size:"medium",children:(0,o.jsx)(d.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,o.jsx)(f.Z,{fontSize:"inherit"})})})})]}),(0,o.jsxs)(m.ZP,{item:!0,sx:S.Z.item,xs:12,lg:4,children:[(0,o.jsx)(_.Z,{variant:"h6",children:"Selection Options"}),(0,o.jsx)(p.Z,{disablePortal:!0,id:"province",size:"small",value:D.sel_province,disabled:0===k.length||D.error.includes("Invalid year")||P,options:k,sx:S.Z.autocomplete,PaperComponent:x.Z,renderInput:function(e){return(0,o.jsx)(y.Z,E({},e,{label:G()}))},getOptionDisabled:function(e){return e.disabled},isOptionEqualToValue:function(e,n){return e.label===n},onChange:function(e,n){return M(e,E({},n,{from:"province"}))}}),(0,o.jsx)(p.Z,{disablePortal:!0,id:"crop",size:"small",value:D.sel_crop,disabled:0===T.length||null===D.sel_province||P,options:T,sx:S.Z.autocomplete,PaperComponent:x.Z,renderInput:function(e){return(0,o.jsx)(y.Z,E({},e,{label:null===D.sel_crop?"Select a crop type":"Crop"}))},isOptionEqualToValue:function(e,n){return e.label===n},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){M(e,E({},n,{from:"crop"})),r(!1)}}),(0,o.jsxs)(g.Z,{disableElevation:!0,size:"small","aria-label":"outlined button controls group",disabled:C||"-"===D.sel_crop,sx:{marginTop:"16px",float:"right"},children:[(0,o.jsx)(v.Z,{variant:"outlined",disabled:P||C,onClick:R,children:"Reset"}),(0,o.jsx)(v.Z,{variant:"contained",onClick:function(){return W()},disabled:P||null===D.sel_province||null===D.sel_crop||""!==D.error||t,children:"Generate"})]})]})]})]})}C.propTypes={optsprovinces:u().array,optscrops:u().array,sel_options:u().object,loading:u().bool,isloadingreport:u().bool,isdisabled:u().bool,open:u().bool,message:u().object,pageTitle:u().string,pageDescription:u().string,pdfPreview:u().object,onSelectItemChange:u().func,handlePreview:u().func,handleSave:u().func,toggleViewerOpen:u().func,resetSelections:u().func,togglePrompt:u().func};var k=C,T=t(66383),D=t(95243),A=t(16327),I=t(61690),L=t(72216),B=t(901),N=t(59390),F=t(38885),z=t(22856),R=t(15497),W=t(94640),H=t(27392),M=t(59111),V=t(77715),G=t(47426),K=t(53063),Y=t(52955);function q(e,n,t,r,i,o,l){try{var a=e[o](l),s=a.value}catch(c){return void t(c)}a.done?n(s):Promise.resolve(s).then(r,i)}function U(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function l(e){q(o,r,i,l,a,"next",e)}function a(e){q(o,r,i,l,a,"throw",e)}l(void 0)}))}}function X(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function $(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){X(e,n,t[n])}))}return e}var J={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:[],sel_month:null,processed:!1,loading:!1,error:"",success:"",sel_condition:{id:0,from:"weather_condition",label:G.MW.WAY_BELOW_NORMAL.label}},Q={url:"",filename:""};var ee=(0,D.Z)((function(e){var n=e.user,t=e.onBtnLogoutClick,r=e.loading,s=(0,l.useState)(J),c=s[0],u=s[1],d=(0,l.useState)([]),f=d[0],p=d[1],v=(0,l.useState)([]),g=v[0],h=v[1],m=(0,l.useState)([]),b=m[0],y=m[1],_=(0,l.useState)([]),x=_[0],j=_[1],w=(0,W.Z)(c.sel_province,c.sel_municipality),O=w.days,S=w.loading,P=w.summary;(0,l.useEffect)((function(){if(O.length>0){var e=(0,Y.Z)(O,"tenday"),n=$({},e);["Flooding/Submergence 3M","Flooding/Submergence 2H"].includes(n.label)&&(e.label="Flooding/Submergence",e.code="flood_submergence")}}),[O]);var E=(0,N.Z)(c.sel_province,c.sel_crop),C=E.cropcalendar,D=E.cropStages,q=E.loading,X=(0,F.Z)().cropList.map((function(e,n){return{disabled:!1,label:e,id:n}})),ee=(0,z.Z)(x,c.sel_crop,"tenday",!0),ne=ee.recommendations,te=ee.loading,re=(0,R.Z)(ne,D,x),ie=re.group,oe=re.error;(0,l.useEffect)((function(){if(O.length>0&&!q&&!te){var e=new Date(O[0].label_full),n=(0,V.Mn)(e);if(0!==C.length){var t=[];Object.values(C).map((function(e){var r=e.find((function(e){return e.municipality===c.sel_municipality&&e.crop===c.sel_crop}));r&&Object.keys(D).length>0&&Object.keys(n).forEach((function(e){var i=r[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==i[0]?t.includes(i[0])||t.push(i[0]):"2nd_half"===e&&"none"!==i[1]&&(t.includes(i[1])||t.push(i[1]))}))}))}));var r=t.map((function(e,n){return{id:n,label:D[e].label,code:e}}));j(r)}}}),[D,C,C.length,C.data1,C.data2,O,c.sel_municipality,c.sel_crop,q,te]);var le=(0,a.v9)((function(e){return e.reports})),ae=le.status,se=le.report,ce=(0,a.v9)((function(e){return e.dashboard.reportType})),ue=(0,a.v9)((function(e){return e.dashboard.isEnglish})),de=(0,l.useState)(!0),fe=de[0],pe=de[1],ve=(0,l.useState)(!1),ge=ve[0],he=ve[1],me=(0,l.useRef)(!1),be=(0,l.useState)(Q),ye=be[0],_e=be[1],xe=(0,l.useState)(H.BF),je=xe[0],we=xe[1],Oe=(0,a.I0)();(0,l.useEffect)((function(){me.current=!0;var e=function(){var e=U(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,A.$m)();case 3:n=e.sent,me&&y(n.data),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){me.current=!1}}),[]),(0,l.useEffect)((function(){Oe((0,L.Km)([])),Oe((0,Z.s_)())}),[Oe]),(0,l.useEffect)((function(){b.length>0&&h((0,M.m)(b))}),[b]),(0,l.useEffect)((function(){null!==P&&u((function(e){return $({},e,{sel_month:{label:P.date_range}})}))}),[P]),(0,l.useEffect)((function(){pe(r||te||q||S)}),[r,te,q,S]),(0,l.useEffect)((function(){_e(Q)}),[ue]),(0,l.useEffect)((function(){ae===B.G.FULLFILLED&&null!==se&&me.current&&we((function(e){return $({},e,{msg:se,loading:!1,savesuccess:!0,docId:se.id})}))}),[ae,se]),(0,l.useEffect)((function(){oe||null===ie||Oe((0,L.Km)(ie))}),[ie,oe,Oe]);var Ze=function(){var e=U(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:we($({},je,{loading:!0,msg:"Generating reports for ".concat(c.sel_province)}));try{t={region:"ilocos",province:c.sel_province,municipality:c.sel_municipality,operation:"create",language:ue?"en":"tag",crop:c.sel_crop},Oe((0,I.a0)(t)).unwrap().then((function(){ce!==H.Ry.TEN_DAY&&(Oe((0,K.uq)(H.Ry.TEN_DAY)),Oe((0,I.RC)({uid:n.uid,type:H.Ry.TEN_DAY})))})).catch((function(e){me.current&&we((function(n){return $({},n,{msg:e,loading:!1,savesuccess:!1,docId:null})}))}))}catch(o){r="",void 0!==o.response&&(r=void 0!==o.response.data&&"[object Blob]"===((i=o.response.data)&&"undefined"!==typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)?o.response.data:""),""===r&&(r=o.message),u((function(e){return $({},e,{loading:!1,error:r})}))}case 2:case"end":return e.stop()}var i}),e)})));return function(){return e.apply(this,arguments)}}();return(0,o.jsx)(T.Z,{loading:r,user:n,onBtnLogoutClick:t,accLevel:G.DW.ADMIN,children:(0,o.jsx)(k,{optsprovinces:g,optscrops:X,sel_options:c,loading:fe,isloadingreport:ae===B.G.PENDING,isdisabled:!1,open:ge,message:je,pageTitle:"10-Day Farm Weather Outlook and Advisory Bulletin",pageDescription:"Create <strong>10-Day Farm Weather Outlook and Advisory</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:ye,onSelectItemChange:function(e,n){var t=n.from,r=n.label;if(f.length>0&&p([]),""!==c.error&&u((function(e){return $({},e,{error:""})})),Object.keys(n).includes("id"))switch(t){case"province":j([]),u((function(e){return $({},e,{sel_province:r,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"municipality":j([]),u((function(e){return $({},e,{sel_municipality:r,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"crop":u((function(e){return $({},e,{sel_crop:r,sel_stage:null,sel_activity:null})})),j([])}else if("province"===t){var i=c.sel_month;u($({},J,{sel_month:i})),j([])}else"municipality"===t&&(u($({},c,{sel_municipality:null,sel_crop:null,sel_day:null,sel_stage:null,sel_activity:null})),j([]))},handleSave:Ze,toggleViewerOpen:function(){he((function(e){return!e}))},resetSelections:function(){var e=c.sel_month;u($({},J,{sel_month:e})),j([]),Oe((0,L.Km)([]))},togglePrompt:function(){we((function(e){return $({},H.BF,{isOpen:!e.isOpen})}))}})})}))},15497:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var r=t(67294);function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return i(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,n,t){var i=(0,r.useState)(null),l=i[0],a=i[1],s=(0,r.useState)(""),c=s[0],u=s[1];return(0,r.useEffect)((function(){if(u(""),(null===e||void 0===e?void 0:e.length)>0&&(null===t||void 0===t?void 0:t.length)>0&&n){var r=e.map((function(e){return e.farming_activity})).filter((function(e,n,t){return t.indexOf(e)===n})),i=null===t||void 0===t?void 0:t.map((function(e){return e.code}));try{a(i.reduce((function(t,i){return null===r||void 0===r||r.forEach((function(r){var l=n[i].label,a=e.filter((function(e){return e.crop_stage===i&&e.farming_activity===r}));a.length>0&&l&&(void 0===t[l]&&(t[l]={}),void 0===t[l][r]&&(t[l][r]=[]),t[l][r]=o(t[l][r]).concat(o(a)))})),t}),{}))}catch(l){a(null),u(l)}}else a(null)}),[e,n,t]),{group:l,error:c}}}},function(e){e.O(0,[5778,2702,8858,8333,6223,6279,8611,7944,7067,1433,1050,2044,3877,5121,9774,2888,179],(function(){return n=67947,e(e.s=n);var n}));var n=e.O();_N_E=n}]);